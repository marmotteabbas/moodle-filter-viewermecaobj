var controls=[];define(["filter_viewermecaobj/three","filter_viewermecaobj/parser","filter_viewermecaobj/OrbitControls"],function(a,b,c){function d(b){var c=new a.Scene,d=new a.MeshPhongMaterial({color:9474192,shading:a.FlatShading}),e=new a.Mesh(b,d);c.add(e),r.position.x=2*b.boundingBox.min.y,r.position.y=2*b.boundingBox.min.y,r.position.z=2*b.boundingBox.max.z,q.position.x=(b.boundingBox.min.y+b.boundingBox.max.y)/2,q.position.y=(b.boundingBox.min.y+b.boundingBox.max.y)/2,q.position.z=2*b.boundingBox.max.z;var f=new a.WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0});f.setSize(464,464);var g;g=m[k][2]>1?"canvas_container_"+(k+1)+"_"+m[k][1]+"_"+m[k][3]:"canvas_container_1_"+m[k][1]+"_"+m[k][3];var h=f.domElement;document.getElementById(g).appendChild(h);var n=new a.PerspectiveCamera(45,1,.1,1e4);n.position.set(0,0,100),c.add(n),i.push(c),s=new a.AmbientLight(2105376),n.add(s),r=new a.DirectionalLight(16777215,.75),r.position.x=1,r.position.y=1,r.position.z=2,r.position.normalize(),n.add(r),q=new a.PointLight(16777215,.3),q.position.x=0,q.position.y=-25,q.position.z=10,n.add(q),l.push(n),j.push(f);var o=new a.OrbitControls(n,h);o.autoRotate=!0,o.ident=g,p.push(o)}function e(){requestAnimationFrame(e),p!==controls&&(controls=p);for(var a=0;a<k;a++)"undefined"!=typeof controls[a]&&"undefined"!=typeof j[a]&&(controls[a].update(),j[a].render(i[a],l[a]))}function f(b,c){var d;try{d=parse_3d_file(b,c)}catch(e){d="Error parsing the file"}if("string"==typeof d)return void alert(d);var f=new a.Geometry;return f.vertices=d.vertices,f.faces=d.faces,f.computeBoundingBox(),f.computeFaceNormals(),f.computeVertexNormals(),a.GeometryUtils.center(f),f}function g(a){var b;b=m[k][2]>1?"loading_"+(k+1)+"_"+m[k][1]+"_"+m[k][3]:"loading_1_"+m[k][1]+"_"+m[k][3];var c=new FileReader;c.onprogress=function(){document.getElementById(b).innerHTML="Processing 3D in browser .."},c.onload=function(c){document.getElementById(b).remove(),d(f(a.name,c.target.result)),k++,e(),"undefined"!=typeof m[k]&&h(m[k][0])},c.readAsArrayBuffer(a)}function h(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.responseType="blob",b.onload=function(){if(200==this.status){var b=this.response;g(new File([b],a,{type:"application/octet-binary",lastModified:Date.now()}))}},b.send()}var i=[],j=[],k=0,l=[],m=[],n=!0,o=!0,p=[],q=new a.PointLight(16777215,.3),r=new a.DirectionalLight(16777215,.75),s=new a.AmbientLight(2105376);return{init:function(a,b,c,d){1==o&&(m=[],controls=[],k=0,o=!1),a.forEach(function(a){m.push([a,b,c,d])}),1==n&&(h(m[0][0]),n=!1)}}});